/**
 * ByteBuffer v1.0.0
 * Copyright (c) 2012-2013 Tim Kurvers <http://moonsphere.net>
 *
 * Wrapper for ArrayBuffer/DataView maintaining index and default endianness.
 * Supports arbitrary reading/writing, implicit growth, clipping, cloning and
 * reversing as well as UTF-8 characters and NULL-terminated C-strings.
 *
 * The contents of this file are subject to the MIT License, under which
 * this library is licensed. See the LICENSE file for the full license.
 */
var ByteBuffer;ByteBuffer=function(){function u(t,n,i){var s;t==null&&(t=0),n==null&&(n=r.BIG_ENDIAN),i==null&&(i=!1),this._buffer=null,this._raw=null,this._view=null,this._order=!!n,this._implicitGrowth=!!i,this._index=0,s=e(t,!0),s||(s=new ArrayBuffer(t)),this.buffer=s}var e,t,n,r,i,s,o=this;return u.LITTLE_ENDIAN=!0,u.BIG_ENDIAN=!1,r=u,t=function(e,t){return Object.defineProperty(u.prototype,e,{get:t,enumerable:!0,configurable:!0})},i=function(e,t){return Object.defineProperty(u.prototype,e,{set:t,enumerable:!0,configurable:!0})},u.prototype._sanitizeIndex=function(){this._index<0&&(this._index=0);if(this._index>this.length)return this._index=this.length},e=function(e,t){t==null&&(t=!1);if(e.byteLength!=null)return e.buffer!=null?t?e.buffer.slice(0):e.buffer:t?e.slice(0):e;if(e.length==null)return null;try{return(new Uint8Array(e)).buffer}catch(n){return null}},t("buffer",function(){return this._buffer}),i("buffer",function(e){return this._buffer=e,this._raw=new Uint8Array(this._buffer),this._view=new DataView(this._buffer),this._sanitizeIndex()}),t("raw",function(){return this._raw}),t("view",function(){return this._view}),t("length",function(){return this._buffer.byteLength}),t("byteLength",function(){return this.length}),t("order",function(){return this._order}),i("order",function(e){return this._order=!!e}),t("implicitGrowth",function(){return this._implicitGrowth}),i("implicitGrowth",function(e){return this._implicitGrowth=!!e}),t("index",function(){return this._index}),i("index",function(e){if(e<0||e>this.length)throw new RangeError("Invalid index "+e+", should be between 0 and "+this.length);return this._index=e}),u.prototype.front=function(){return this._index=0,this},u.prototype.end=function(){return this._index=this.length,this},u.prototype.seek=function(e){return e==null&&(e=1),this.index+=e,this},t("available",function(){return this.length-this._index}),n=function(e,t){return function(n){var r;n==null&&(n=this._order);if(t>this.available)throw new Error("Cannot read "+t+" byte(s), "+this.available+" available");return r=this._view[e](this._index,n),this._index+=t,r}},s=function(e,t){return function(n,r){var i;r==null&&(r=this._order),i=this.available;if(t>i){if(!this._implicitGrowth)throw new Error("Cannot write "+n+" using "+t+" byte(s), "+i+" available");this.append(t-i)}return this._view[e](this._index,n,r),this._index+=t,this}},u.prototype.readByte=n("getInt8",1),u.prototype.readUnsignedByte=n("getUint8",1),u.prototype.readShort=n("getInt16",2),u.prototype.readUnsignedShort=n("getUint16",2),u.prototype.readInt=n("getInt32",4),u.prototype.readUnsignedInt=n("getUint32",4),u.prototype.readFloat=n("getFloat32",4),u.prototype.readDouble=n("getFloat64",8),u.prototype.writeByte=s("setInt8",1),u.prototype.writeUnsignedByte=s("setUint8",1),u.prototype.writeShort=s("setInt16",2),u.prototype.writeUnsignedShort=s("setUint16",2),u.prototype.writeInt=s("setInt32",4),u.prototype.writeUnsignedInt=s("setUint32",4),u.prototype.writeFloat=s("setFloat32",4),u.prototype.writeDouble=s("setFloat64",8),u.prototype.read=function(e){var t;e==null&&(e=this.available);if(e>this.available)throw new Error("Cannot read "+e+" byte(s), "+this.available+" available");if(e<=0)throw new RangeError("Invalid number of bytes "+e);return t=new r(this._buffer.slice(this._index,this._index+e),this.order),this._index+=e,t},u.prototype.write=function(t){var n,r,i;if(t instanceof Uint8Array)i=t;else{r=e(t);if(!r)throw new TypeError("Cannot write "+t+", not a sequence");i=new Uint8Array(r)}n=this.available;if(i.byteLength>n){if(!this._implicitGrowth)throw new Error("Cannot write "+t+" using "+i.byteLength+" byte(s), "+this.available+" available");this.append(i.byteLength-n)}return this._raw.set(i,this._index),this._index+=i.byteLength,this},u.prototype.readString=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p;e==null&&(e=this.available);if(e>this.available)throw new Error("Cannot read "+e+" byte(s), "+this.available+" available");if(e<=0)throw new RangeError("Invalid number of bytes "+e);h=this._raw,u=[],s=0,t=n=r=i=null,p=this._index+e;while(this._index<p){t=h[this._index];if(t<128)u[s++]=t,this._index++;else{if(t<194)throw new Error("Unexpected continuation byte");if(t<224){n=h[this._index+1];if(n<128||n>191)throw new Error("Bad continuation byte");u[s++]=((t&31)<<6)+(n&63),this._index+=2}else if(t<240){n=h[this._index+1];if(n<128||n>191)throw new Error("Bad continuation byte");r=h[this._index+2];if(r<128||r>191)throw new Error("Bad continuation byte");u[s++]=((t&15)<<12)+((n&63)<<6)+(r&63),this._index+=3}else{if(!(t<245))throw new Error("Illegal byte");n=h[this._index+1];if(n<128||n>191)throw new Error("Bad continuation byte");r=h[this._index+2];if(r<128||r>191)throw new Error("Bad continuation byte");i=h[this._index+3];if(i<128||i>191)throw new Error("Bad continuation byte");a=((t&7)<<18)+((n&63)<<12)+((r&63)<<6)+(i&63),a-=65536,u[s++]=55296+((a&1047552)>>>10),u[s++]=56320+(a&1023),this._index+=4}}}c=65536,l=u.length;if(l<c)return String.fromCharCode.apply(String,u);o=[],f=0;while(f<l)o.push(String.fromCharCode.apply(String,u.slice(f,f+c))),f+=c;return o.join("")},u.prototype.writeString=function(e){var t,n,r,i,s,o,u;n=[],u=e.length,o=0,t=0;while(o<u){r=e.charCodeAt(o);if(r<=127)n[t++]=r;else if(r<=2047)n[t++]=192|(r&1984)>>>6,n[t++]=128|r&63;else if(r<=55295||r>=57344&&r<=65535)n[t++]=224|(r&61440)>>>12,n[t++]=128|(r&4032)>>>6,n[t++]=128|r&63;else{if(o===u-1)throw new Error("Unpaired surrogate "+e[o]+" (index "+o+")");s=e.charCodeAt(++o);if(r<55296||r>56319||s<56320||s>57343)throw new Error("Unpaired surrogate "+e[o]+" (index "+o+")");i=((r&1023)<<10)+(s&1023)+65536,n[t++]=240|(i&1835008)>>>18,n[t++]=128|(i&258048)>>>12,n[t++]=128|(i&4032)>>>6,n[t++]=128|i&63}++o}return this.write(n),n.length},u.prototype.readUTFChars=u.prototype.readString,u.prototype.writeUTFChars=u.prototype.writeString,u.prototype.readCString=function(){var e,t,n,r;e=this._raw,n=e.length,t=this._index;while(e[t]!==0&&t<n)++t;return n=t-this._index,n>0?(r=this.readString(n),this.readByte(),r):null},u.prototype.writeCString=function(e){var t;return t=this.writeString(e),this.writeByte(0),++t},u.prototype.prepend=function(e){var t;if(e<=0)throw new RangeError("Invalid number of bytes "+e);return t=new Uint8Array(this.length+e),t.set(this._raw,e),this._index+=e,this.buffer=t.buffer,this},u.prototype.append=function(e){var t;if(e<=0)throw new RangeError("Invalid number of bytes "+e);return t=new Uint8Array(this.length+e),t.set(this._raw,0),this.buffer=t.buffer,this},u.prototype.clip=function(e,t){var n;return e==null&&(e=this._index),t==null&&(t=this.length),e<0&&(e=this.length+e),n=this._buffer.slice(e,t),this._index-=e,this.buffer=n,this},u.prototype.slice=function(e,t){var n;return e==null&&(e=0),t==null&&(t=this.length),n=new r(this._buffer.slice(e,t),this.order),n},u.prototype.clone=function(){var e;return e=new r(this._buffer.slice(0),this.order,this.implicitGrowth),e.index=this._index,e},u.prototype.reverse=function(){return Array.prototype.reverse.call(this._raw),this._index=0,this},u.prototype.toArray=function(){return Array.prototype.slice.call(this._raw,0)},u.prototype.toString=function(){var e;return e=this._order===r.BIG_ENDIAN?"big-endian":"little-endian","[ByteBuffer; Order: "+e+"; Length: "+this.length+"; Index: "+this._index+"; Available: "+this.available+"]"},u.prototype.toHex=function(e){return e==null&&(e=" "),Array.prototype.map.call(this._raw,function(e){return("00"+e.toString(16).toUpperCase()).slice(-2)}).join(e)},u.prototype.toASCII=function(e,t,n){var r;return e==null&&(e=" "),t==null&&(t=!0),n==null&&(n="?"),r=t?" ":"",Array.prototype.map.call(this._raw,function(e){return e<32||e>126?r+n:r+String.fromCharCode(e)}).join(e)},u}.call(this);